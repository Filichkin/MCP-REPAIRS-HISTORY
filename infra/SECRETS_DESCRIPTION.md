# Описание переменных окружения (секретов)

Данный документ описывает все переменные окружения, используемые в проекте MCP-REPAIRS-HISTORY.

## Конфигурация MCP сервера

### MCP_SERVER_PORT
- **Описание**: Порт, на котором будет запущен MCP сервер
- **Тип**: Число
- **Значение по умолчанию**: `8004`
- **Пример**: `8004`

### MCP_SERVER_HOST
- **Описание**: IP-адрес или хост, на котором будет слушать MCP сервер
- **Тип**: Строка
- **Значение по умолчанию**: `0.0.0.0` (для публичного доступа)
- **Рекомендации**: 
  - `0.0.0.0` - для публичного доступа
  - `127.0.0.1` - только для локального доступа
- **Пример**: `0.0.0.0`

### MCP_SERVER_URL
- **Описание**: Полный URL адрес MCP сервера
- **Тип**: Строка (URL)
- **Значение по умолчанию**: `http://localhost:8004`
- **Пример**: `http://localhost:8004` или `https://your-domain.com:8004`

### MCP_TRANSPORT
- **Описание**: Тип транспорта для MCP протокола
- **Тип**: Строка
- **Значение по умолчанию**: `http`
- **Доступные значения**: 
  - `http` - Streamable HTTP (рекомендуется для production)
  - `sse` - Server-Sent Events (устаревший)
- **Пример**: `http`

### MCP_TIMEOUT
- **Описание**: Таймаут для операций MCP в секундах
- **Тип**: Число
- **Значение по умолчанию**: `30`
- **Пример**: `30`

### MCP_MAX_RETRIES
- **Описание**: Максимальное количество повторных попыток при ошибках MCP
- **Тип**: Число
- **Значение по умолчанию**: `3`
- **Пример**: `3`

## Безопасность MCP сервера

### MCP_AUTH_ENABLED
- **Описание**: Включение Bearer token аутентификации для MCP сервера
- **Тип**: Булево значение
- **Значение по умолчанию**: `false`
- **Рекомендации**: Установите в `true` для production окружения
- **Пример**: `true` или `false`

### MCP_AUTH_TOKEN
- **Описание**: Секретный токен для Bearer аутентификации MCP сервера
- **Тип**: Строка (секрет)
- **Значение по умолчанию**: Пусто
- **Рекомендации**: 
  - Генерируйте безопасный токен для production (например: `openssl rand -hex 32`)
  - Храните в секретах, не коммитьте в репозиторий
- **Пример**: `a1b2c3d4e5f6...` (32+ символов)

### MCP_ENABLE_TLS
- **Описание**: ⚠️ **УСТАРЕВШЕЕ** - Включение встроенного TLS
- **Тип**: Булево значение
- **Статус**: Deprecated
- **Рекомендации**: Используйте nginx reverse proxy для HTTPS вместо этого параметра
- **Пример**: `false`

### MCP_TLS_CERT_FILE
- **Описание**: ⚠️ **УСТАРЕВШЕЕ** - Путь к файлу TLS сертификата
- **Тип**: Строка (путь к файлу)
- **Статус**: Deprecated
- **Рекомендации**: Настройте TLS в nginx конфигурации
- **Пример**: Пусто

### MCP_TLS_KEY_FILE
- **Описание**: ⚠️ **УСТАРЕВШЕЕ** - Путь к файлу TLS приватного ключа
- **Тип**: Строка (путь к файлу)
- **Статус**: Deprecated
- **Рекомендации**: Настройте TLS в nginx конфигурации
- **Пример**: Пусто

## Конфигурация Vehicle Repairs API

### API_KEY
- **Описание**: API ключ для доступа к Vehicle Repairs API (Необходимо обратиться к дистрибьютеру)
- **Тип**: Строка (секрет)
- **Значение по умолчанию**: `your-api-key-here`
- **Рекомендации**: 
  - Получите реальный ключ от провайдера API
  - Храните в секретах, не коммитьте в репозиторий
- **Пример**: `sk_live_abc123...`

### API_URL
- **Описание**: Базовый URL адрес Vehicle Repairs API
- **Тип**: Строка (URL)
- **Значение по умолчанию**: `http://your-api-url-here`
- **Пример**: `https://api.example.com/v1`

## Конфигурация Cloud RAG (База знаний)

### KEY_ID
- **Описание**: Client ID для OAuth2 аутентификации в RAG API
- **Тип**: Строка (секрет)
- **Значение по умолчанию**: `your-client-id-here`
- **Рекомендации**: 
  - Получите из консоли SberCloud
  - Храните в секретах, не коммитьте в репозиторий
- **Пример**: `client_id_12345...`

### KEY_SECRET
- **Описание**: Client Secret для OAuth2 аутентификации в RAG API
- **Тип**: Строка (секрет)
- **Значение по умолчанию**: `your-client-secret-here`
- **Рекомендации**: 
  - Получите из консоли SberCloud
  - Храните в секретах, не коммитьте в репозиторий
- **Пример**: `client_secret_67890...`

### AUTH_URL
- **Описание**: URL эндпоинта для получения OAuth2 токена
- **Тип**: Строка (URL)
- **Значение по умолчанию**: `https://auth.iam.sbercloud.ru/auth/system/openid/token`
- **Пример**: `https://auth.iam.sbercloud.ru/auth/system/openid/token`

### RETRIEVE_URL_TEMPLATE
- **Описание**: Шаблон URL для эндпоинта извлечения данных из RAG API
- **Тип**: Строка (URL шаблон)
- **Значение по умолчанию**: `https://your-rag-instance.managed-rag.inference.cloud.ru/api/v2/retrieve`
- **Пример**: `https://my-rag-instance.managed-rag.inference.cloud.ru/api/v2/retrieve`

### KNOWLEDGE_BASE_ID
- **Описание**: Уникальный идентификатор базы знаний в RAG системе
- **Тип**: Строка
- **Значение по умолчанию**: `your-knowledge-base-id-here`
- **Пример**: `kb_1234567890`

### KNOWLEDGE_BASE_VERSION_ID
- **Описание**: Идентификатор версии базы знаний
- **Тип**: Строка
- **Значение по умолчанию**: `latest`
- **Рекомендации**: 
  - `latest` - использовать последнюю версию
  - Или укажите конкретную версию: `v1.0.0`
- **Пример**: `latest` или `v1.0.0`

### RETRIEVE_LIMIT
- **Описание**: Максимальное количество результатов при извлечении из базы знаний
- **Тип**: Число
- **Значение по умолчанию**: `3`
- **Пример**: `3`, `5`, `10`

### EVOLUTION_PROJECT_ID
- **Описание**: Идентификатор проекта в Evolution системе
- **Тип**: Строка
- **Значение по умолчанию**: `your-project-id-here`
- **Пример**: `proj_1234567890`

## Конфигурация GigaChat

### GIGACHAT_API_KEY
- **Описание**: API ключ для доступа к GigaChat (используется при `GIGACHAT_USE_API=false`)
- **Тип**: Строка (секрет)
- **Значение по умолчанию**: Пусто
- **Рекомендации**: 
  - Получите из личного кабинета GigaChat
  - Храните в секретах, не коммитьте в репозиторий
- **Пример**: `gigachat_api_key_abc123...`

### GIGACHAT_KEY_ID
- **Описание**: Key ID для OAuth2 аутентификации в GigaChat API (используется при `GIGACHAT_USE_API=true`)
- **Тип**: Строка (секрет)
- **Значение по умолчанию**: Пусто
- **Рекомендации**: 
  - Получите из личного кабинета GigaChat
  - Храните в секретах, не коммитьте в репозиторий
- **Пример**: `key_id_12345...`

### GIGACHAT_KEY_SECRET
- **Описание**: Key Secret для OAuth2 аутентификации в GigaChat API (используется при `GIGACHAT_USE_API=true`)
- **Тип**: Строка (секрет)
- **Значение по умолчанию**: Пусто
- **Рекомендации**: 
  - Получите из личного кабинета GigaChat
  - Храните в секретах, не коммитьте в репозиторий
- **Пример**: `key_secret_67890...`

### GIGACHAT_SCOPE
- **Описание**: Область доступа (scope) для OAuth2 токена GigaChat
- **Тип**: Строка
- **Значение по умолчанию**: `GIGACHAT_API_PERS`
- **Пример**: `GIGACHAT_API_PERS`

### GIGACHAT_MODEL
- **Описание**: Название модели GigaChat для использования
- **Тип**: Строка
- **Значение по умолчанию**: `GigaChat-2`
- **Доступные значения**: 
  - `GigaChat-2`
  - `GigaChat-Max`
  - `GigaChat-Pro`
  - И другие доступные модели
- **Пример**: `GigaChat-2`

### GIGACHAT_TEMPERATURE
- **Описание**: Параметр температуры для генерации ответов (контролирует случайность)
- **Тип**: Число (с плавающей точкой)
- **Значение по умолчанию**: `0.1`
- **Диапазон**: `0.0` - `2.0`
- **Рекомендации**: 
  - Низкие значения (0.1-0.3) - более детерминированные ответы
  - Высокие значения (0.7-1.0) - более креативные ответы
- **Пример**: `0.1`

### GIGACHAT_TIMEOUT
- **Описание**: Таймаут для запросов к GigaChat API в секундах
- **Тип**: Число
- **Значение по умолчанию**: `60`
- **Пример**: `60`

### GIGACHAT_MAX_RETRIES
- **Описание**: Максимальное количество повторных попыток при ошибках GigaChat API
- **Тип**: Число
- **Значение по умолчанию**: `3`
- **Пример**: `3`

### GIGACHAT_USE_API
- **Описание**: Выбор метода работы с GigaChat
- **Тип**: Булево значение
- **Значение по умолчанию**: `false`
- **Доступные значения**:
  - `false` - использовать `langchain_gigachat` (по умолчанию)
  - `true` - использовать прямой API GigaChat через Evolution Platform
- **Пример**: `false` или `true`

### GIGACHAT_TOP_P
- **Описание**: Nucleus sampling параметр (используется только при `GIGACHAT_USE_API=true`)
- **Тип**: Число (с плавающей точкой) или пусто
- **Значение по умолчанию**: Пусто (None)
- **Диапазон**: `0.0` - `1.0`
- **Рекомендации**: 
  - Контролирует разнообразие токенов в ответе
  - Обычно используется вместе с temperature
- **Пример**: `0.9` или пусто

### GIGACHAT_MAX_TOKENS
- **Описание**: Максимальное количество токенов в ответе GigaChat (используется только при `GIGACHAT_USE_API=true`)
- **Тип**: Число
- **Значение по умолчанию**: `512`
- **Пример**: `512`, `1024`, `2048`

### GIGACHAT_REPETITION_PENALTY
- **Описание**: Штраф за повторения в ответе (используется только при `GIGACHAT_USE_API=true`)
- **Тип**: Число (с плавающей точкой)
- **Значение по умолчанию**: `1.0`
- **Диапазон**: `0.0` - `2.0`
- **Рекомендации**: 
  - `1.0` - без штрафа
  - `> 1.0` - уменьшает повторения
  - `< 1.0` - увеличивает повторения
- **Пример**: `1.0`

## Конфигурация агента

### AGENT_MAX_ITERATIONS
- **Описание**: Максимальное количество итераций выполнения агента
- **Тип**: Число
- **Значение по умолчанию**: `10`
- **Пример**: `10`, `20`, `50`

### AGENT_MAX_EXECUTION_TIME
- **Описание**: Максимальное время выполнения агента в секундах
- **Тип**: Число
- **Значение по умолчанию**: `120`
- **Пример**: `120` (2 минуты), `300` (5 минут)

### AGENT_ENABLE_STREAMING
- **Описание**: Включение потоковой передачи ответов агента
- **Тип**: Булево значение
- **Значение по умолчанию**: `true`
- **Пример**: `true` или `false`

## Конфигурация приложения

### APP_NAME
- **Описание**: Название приложения
- **Тип**: Строка
- **Значение по умолчанию**: `Warranty Agent System`
- **Пример**: `Warranty Agent System`

### APP_VERSION
- **Описание**: Версия приложения
- **Тип**: Строка
- **Значение по умолчанию**: `0.1.0`
- **Пример**: `0.1.0`, `1.0.0`

### APP_DEBUG
- **Описание**: Включение режима отладки приложения
- **Тип**: Булево значение
- **Значение по умолчанию**: `false`
- **Рекомендации**: 
  - `true` - для разработки
  - `false` - для production
- **Пример**: `false`

### LOG_LEVEL
- **Описание**: Уровень логирования
- **Тип**: Строка
- **Значение по умолчанию**: `INFO`
- **Доступные значения**: 
  - `DEBUG` - детальная отладочная информация
  - `INFO` - информационные сообщения
  - `WARNING` - предупреждения
  - `ERROR` - ошибки
  - `CRITICAL` - критические ошибки
- **Пример**: `INFO`

## Конфигурация API

### API_HOST
- **Описание**: IP-адрес или хост, на котором будет слушать API сервер
- **Тип**: Строка
- **Значение по умолчанию**: `0.0.0.0`
- **Пример**: `0.0.0.0` или `127.0.0.1`

### API_PORT
- **Описание**: Порт, на котором будет запущен API сервер
- **Тип**: Число
- **Значение по умолчанию**: `8005`
- **Пример**: `8005`

### API_RELOAD
- **Описание**: Автоматическая перезагрузка при изменении кода (hot reload)
- **Тип**: Булево значение
- **Значение по умолчанию**: `false`
- **Рекомендации**: 
  - `true` - для разработки
  - `false` - для production
- **Пример**: `false`

### API_CORS_ORIGINS
- **Описание**: Список разрешенных источников для CORS (Cross-Origin Resource Sharing)
- **Тип**: JSON массив строк
- **Значение по умолчанию**: `["*"]` (разрешены все источники)
- **Рекомендации**: 
  - Для production укажите конкретные домены
  - `["*"]` - разрешены все (небезопасно для production)
- **Пример**: `["*"]` или `["https://example.com", "https://app.example.com"]`

---

## Безопасность

⚠️ **ВАЖНО**: Все переменные, помеченные как "секрет", должны:
- Храниться в безопасном хранилище секретов
- Никогда не коммититься в репозиторий
- Использовать сильные, случайно сгенерированные значения
- Регулярно обновляться

## Генерация секретов

Для генерации безопасных токенов используйте:
```bash
# Генерация случайного токена (32 байта в hex)
openssl rand -hex 32

# Генерация случайного токена (64 байта в hex)
openssl rand -hex 64
```
